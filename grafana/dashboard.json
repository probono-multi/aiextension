{
  "title": "Playwright Automation â€“ Project Observability",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "30s",
  "templating": {
    "list": [
      {
        "type": "query",
        "name": "run",
        "label": "Latest Run",
        "hide": 0,
        "datasource": "InfluxDB",
        "query": "from(bucket: \"test_runs\")\n  |> range(start: -7d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> keep(columns: [\"run_id\"])\n  |> group()\n  |> distinct(column: \"run_id\")\n  |> sort(columns: [\"run_id\"], desc: true)\n  |> limit(n: 1)\n  |> map(fn: (r) => ({ _value: r.run_id }))",
        "refresh": 1
      },
      {
        "type": "query",
        "name": "screenshot_url",
        "label": "Latest Screenshot URL",
        "hide": 0,
        "datasource": "InfluxDB",
        "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_artifacts\")\n  |> filter(fn: (r) => r._field == \"url\")\n  |> filter(fn: (r) => r.type == \"screenshot\")\n  |> last()\n  |> keep(columns: [\"_value\"])\n  |> limit(n:1)",
        "refresh": 1
      }
    ]
  },
  "panels": [
    {
      "type": "table",
      "title": "Execution History",
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 8 },
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> pivot(rowKey:[\"_time\"], columnKey:[\"_field\"], valueColumn:\"_value\")\n  |> keep(columns: [\"_time\",\"project\",\"environment\",\"total\",\"passed\",\"failed\",\"skipped\",\"duration_sec\"])\n  |> sort(columns:[\"_time\"], desc:true)"
        }
      ],
      "options": {
        "showHeader": true
      }
    },
    {
      "type": "table",
      "title": "Artifact URLs (latest run)",
      "gridPos": { "x": 0, "y": 8, "w": 24, "h": 4 },
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> filter(fn: (r) => r._field == \"artifacts\")\n  |> last()"
        }
      ],
      "options": {
        "showHeader": true
      }
    },
    {
      "type": "text",
      "title": "Screenshots Preview - How to",
      "gridPos": { "x": 0, "y": 12, "w": 24, "h": 4 },
      "mode": "html",
      "content": "<p>Use the <strong>Latest Run</strong> dropdown (top) to pick a run. The table above shows the raw JSON with artifact URLs. To preview screenshots directly, we added a variable <code>$screenshot_url</code> that points to the latest screenshot for the selected run. The panel below will embed it automatically.</p>\n<pre><code>&lt;img src=\"$screenshot_url\" width=\"900\"&gt;</code></pre>\n<p>Note: If <code>$screenshot_url</code> is empty, make sure the reporter has written artifact points (`playwright_artifacts`) for the run and that the run variable is selected.</p>"
    },
    {
      "type": "text",
      "title": "Latest Screenshot",
      "gridPos": { "x": 0, "y": 16, "w": 24, "h": 10 },
      "mode": "html",
      "content": "<div style=\"display:flex;justify-content:center;\">\n  <img src=\"$screenshot_url\" style=\"max-width:100%;height:auto;\" alt=\"Latest screenshot\" />\n</div>"
    },
    {
      "type": "timeseries",
      "title": "Pass vs Fail Trend",
      "gridPos": { "x": 0, "y": 8, "w": 12, "h": 8 },
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> filter(fn: (r) => r._field == \"passed\" or r._field == \"failed\")"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Execution Duration Trend (seconds)",
      "gridPos": { "x": 12, "y": 8, "w": 12, "h": 8 },
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> filter(fn: (r) => r._field == \"duration_sec\")"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Failure Rate (%)",
      "gridPos": { "x": 0, "y": 16, "w": 12, "h": 8 },
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> pivot(rowKey:[\"_time\"], columnKey:[\"_field\"], valueColumn:\"_value\")\n  |> map(fn: (r) => ({ r with failure_rate: (float(v: r.failed) / float(v: r.total)) * 100.0 }))"
        }
      ]
    },
    {
      "type": "timeseries",
      "title": "Execution Volume",
      "gridPos": { "x": 12, "y": 16, "w": 12, "h": 8 },
      "datasource": "InfluxDB",
      "targets": [
        {
          "query": "from(bucket: \"test_runs\")\n  |> range(start: -30d)\n  |> filter(fn: (r) => r._measurement == \"playwright_runs\")\n  |> count()"
        }
      ]
    }
  ]
}
